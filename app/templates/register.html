{% extends "base.html" %}

{% block title %}Registro - ShipFlow{% endblock %}

{% block content %}
<div style="max-width: 400px; margin: 50px auto; padding: 20px; text-align: center;">
    <h2>Crear Cuenta</h2>
    <form id="registerForm" style="display: flex; flex-direction: column; gap: 15px; margin-top: 20px;">
        <div>
            <input type="email" name="email" placeholder="Email" required
                style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
        </div>
        <div>
            <input type="password" name="password" placeholder="Contraseña" required
                style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
        </div>
        <button type="submit"
            style="padding: 10px; background: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer;">
            Registrarse
        </button>
    </form>
    <div id="errorMsg" style="color: red; margin-top: 10px; display: none;"></div>
    <p style="margin-top: 20px;">
        ¿Ya tienes cuenta? <a href="/login">Inicia Sesión</a>
    </p>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());
        const errorDiv = document.getElementById('errorMsg');

        try {
            const resp = await fetch('/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            if (resp.ok) {
                window.location.href = '/settings';
            } else {
                const err = await resp.json();
                errorDiv.textContent = err.detail || 'Error en el registro';
                errorDiv.style.display = 'block';
            }
        } catch (e) {
            errorDiv.textContent = 'Error de conexión';
            errorDiv.style.display = 'block';
        }
    });
</script>
{% endblock %}